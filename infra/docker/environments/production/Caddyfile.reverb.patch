# ============================================
# PATCH: Agregar proxy WebSocket a Caddyfile
# ============================================
# 
# INSTRUCCIONES:
# 1. Abrir Caddyfile
# 2. Dentro del bloque "api.notificaciones.space {"
# 3. Agregar la sección "handle /app/*" DESPUÉS del bloque "reverse_proxy nginx-api:80"
#    y ANTES del bloque "log {"
#
# Ubicación: Después de la línea 14 (después del reverse_proxy a nginx-api)
# ============================================

    # WebSocket proxy para Reverb
    # Ruta específica para WebSocket connections
    handle /app/* {
        reverse_proxy reverb:8080 {
            # Headers necesarios para WebSocket
            header_up Connection {>Connection}
            header_up Upgrade {>Upgrade}
            header_up X-Real-IP {remote_host}
            header_up Host {host}
            
            # Timeout largo para mantener conexiones WebSocket
            transport http {
                dial_timeout 30s
                response_header_timeout 30s
            }
        }
    }



