# Gu√≠a de Acceso a Notificaciones - Yape Notifier

Esta gu√≠a explica c√≥mo habilitar y diagnosticar el acceso a notificaciones en Yape Notifier, con instrucciones espec√≠ficas para dispositivos OPPO/realme/OnePlus y otros OEMs.

## üìã √çndice

1. [Habilitar el Permiso de Notificaciones](#habilitar-el-permiso-de-notificaciones)
2. [Instrucciones Espec√≠ficas para OPPO/realme/OnePlus](#instrucciones-espec√≠ficas-para-opporealmeoneplus)
3. [Instrucciones para Otros OEMs](#instrucciones-para-otros-oems)
4. [Checklist de Verificaci√≥n](#checklist-de-verificaci√≥n)
5. [Diagn√≥stico y Soluci√≥n de Problemas](#diagn√≥stico-y-soluci√≥n-de-problemas)
6. [C√≥mo Probar](#c√≥mo-probar)

---

## Habilitar el Permiso de Notificaciones

### Pasos Generales (Todos los Dispositivos)

1. **Abrir la app Yape Notifier**
2. **Ir a la pantalla de Diagn√≥stico** (bot√≥n "Abrir Diagn√≥stico de Notificaciones" en la pantalla principal)
3. **Tocar el bot√≥n "Abrir Ajustes de Notificaciones"**
4. **En la pantalla del sistema:**
   - Buscar "Yape Notifier" en la lista
   - Activar el interruptor junto a "Yape Notifier"
   - Confirmar el di√°logo de permisos si aparece
5. **Volver a la app** y verificar que el estado muestre "‚úÖ Acceso a Notificaciones: HABILITADO"

### M√©todo Alternativo (Manual)

1. Ir a **Configuraci√≥n del sistema** ‚Üí **Aplicaciones** ‚Üí **Acceso especial** ‚Üí **Acceso a notificaciones**
2. Buscar "Yape Notifier"
3. Activar el interruptor

---

## Instrucciones Espec√≠ficas para OPPO/realme/OnePlus

Los dispositivos OPPO, realme y OnePlus (que usan ColorOS/realme UI) tienen restricciones adicionales que pueden impedir que el servicio funcione correctamente. Sigue estos pasos **en orden**:

### Paso 1: Habilitar Acceso a Notificaciones

1. Abre **Configuraci√≥n** ‚Üí **Aplicaciones** ‚Üí **Gesti√≥n de aplicaciones**
2. Busca "Yape Notifier"
3. Toca en "Permisos"
4. Aseg√∫rate de que "Notificaciones" est√© habilitado
5. Ve a **Configuraci√≥n** ‚Üí **Aplicaciones** ‚Üí **Acceso especial** ‚Üí **Acceso a notificaciones**
6. Activa "Yape Notifier"

### Paso 2: Desactivar Optimizaci√≥n de Bater√≠a

1. Abre **Configuraci√≥n** ‚Üí **Bater√≠a**
2. Toca en **Optimizaci√≥n de bater√≠a** o **Ahorro de bater√≠a**
3. Busca "Yape Notifier"
4. Selecciona "No optimizar" o "Sin restricciones"
5. Confirma los cambios

### Paso 3: Permitir Auto-inicio (Auto-start)

1. Abre **Configuraci√≥n** ‚Üí **Aplicaciones** ‚Üí **Gesti√≥n de aplicaciones**
2. Busca "Yape Notifier"
3. Toca en **Auto-inicio** o **Inicio autom√°tico**
4. Activa el interruptor para "Yape Notifier"

### Paso 4: Permitir Ejecuci√≥n en Segundo Plano

1. Abre **Configuraci√≥n** ‚Üí **Aplicaciones** ‚Üí **Gesti√≥n de aplicaciones**
2. Busca "Yape Notifier"
3. Toca en **Ejecuci√≥n en segundo plano**
4. Selecciona "Permitir" o "Sin restricciones"

### Paso 5: Verificar Configuraci√≥n de Notificaciones

1. Abre **Configuraci√≥n** ‚Üí **Aplicaciones** ‚Üí **Gesti√≥n de aplicaciones**
2. Busca "Yape Notifier"
3. Toca en **Notificaciones**
4. Aseg√∫rate de que todas las opciones est√©n habilitadas:
   - Mostrar notificaciones
   - Sonido
   - Vibraci√≥n (opcional)

### Paso 6: Reiniciar el Listener (si es necesario)

Si despu√©s de seguir todos los pasos el servicio no funciona:

1. Abre la app Yape Notifier
2. Ve a **Diagn√≥stico de Notificaciones**
3. Toca el bot√≥n **"Reiniciar Listener"**
4. Espera unos segundos
5. Verifica que el estado muestre "‚úÖ Acceso a Notificaciones: HABILITADO"

---

## Instrucciones para Otros OEMs

### Xiaomi/Redmi/POCO (MIUI)

1. **Habilitar acceso a notificaciones** (igual que pasos generales)
2. **Desactivar optimizaci√≥n de bater√≠a:**
   - Configuraci√≥n ‚Üí Bater√≠a ‚Üí Optimizaci√≥n de bater√≠a
   - Buscar "Yape Notifier" ‚Üí No optimizar
3. **Permitir auto-inicio:**
   - Configuraci√≥n ‚Üí Aplicaciones ‚Üí Gesti√≥n de aplicaciones ‚Üí Yape Notifier ‚Üí Auto-inicio
4. **Desactivar restricci√≥n de actividad en segundo plano:**
   - Configuraci√≥n ‚Üí Aplicaciones ‚Üí Gesti√≥n de aplicaciones ‚Üí Yape Notifier ‚Üí Restricciones ‚Üí Sin restricciones

### Huawei/Honor (EMUI)

1. **Habilitar acceso a notificaciones**
2. **Desactivar optimizaci√≥n de bater√≠a:**
   - Configuraci√≥n ‚Üí Bater√≠a ‚Üí Inicio de aplicaciones
   - Buscar "Yape Notifier" ‚Üí Gesti√≥n manual ‚Üí Permitir
3. **Permitir inicio autom√°tico:**
   - Configuraci√≥n ‚Üí Aplicaciones ‚Üí Inicio de aplicaciones ‚Üí Yape Notifier ‚Üí Activar
4. **A√±adir a apps protegidas:**
   - Configuraci√≥n ‚Üí Bater√≠a ‚Üí Apps protegidas ‚Üí Yape Notifier ‚Üí Activar

### Samsung (One UI)

1. **Habilitar acceso a notificaciones**
2. **Desactivar optimizaci√≥n de bater√≠a:**
   - Configuraci√≥n ‚Üí Mantenimiento del dispositivo ‚Üí Bater√≠a ‚Üí Aplicaciones que nunca se duermen
   - A√±adir "Yape Notifier"
3. **Permitir ejecuci√≥n en segundo plano:**
   - Configuraci√≥n ‚Üí Aplicaciones ‚Üí Yape Notifier ‚Üí Bater√≠a ‚Üí Sin restricciones

---

## Checklist de Verificaci√≥n

Usa esta lista para verificar que todo est√© configurado correctamente:

### ‚úÖ Permisos y Acceso

- [ ] Acceso a notificaciones habilitado en Configuraci√≥n del sistema
- [ ] El estado en la app muestra "‚úÖ Acceso a Notificaciones: HABILITADO"
- [ ] El componente del servicio est√° habilitado (verificado en Diagn√≥stico)

### ‚úÖ Optimizaci√≥n de Bater√≠a

- [ ] Optimizaci√≥n de bater√≠a desactivada para Yape Notifier
- [ ] El estado en la app muestra "‚úÖ Optimizaci√≥n de Bater√≠a: DESACTIVADA"

### ‚úÖ OEM Espec√≠fico (OPPO/Xiaomi/Huawei)

- [ ] Auto-inicio habilitado (si aplica)
- [ ] Ejecuci√≥n en segundo plano permitida
- [ ] App a√±adida a apps protegidas (Huawei)

### ‚úÖ Funcionamiento

- [ ] El servicio se conecta correctamente (ver logs)
- [ ] Las notificaciones de prueba se capturan
- [ ] Las notificaciones reales de apps de pago se procesan

---

## Diagn√≥stico y Soluci√≥n de Problemas

### Pantalla de Diagn√≥stico

La app incluye una pantalla de diagn√≥stico completa que puedes acceder desde:
- **MainActivity** ‚Üí Bot√≥n "Abrir Diagn√≥stico de Notificaciones"

Esta pantalla muestra:
- Estado del acceso a notificaciones
- Estado del componente del servicio
- Estado de optimizaci√≥n de bater√≠a
- Informaci√≥n del dispositivo y OEM
- Recomendaciones espec√≠ficas para tu dispositivo
- Acciones para habilitar acceso y reiniciar el servicio

### Ver Notificaciones Capturadas (Debug)

Para inspeccionar las √∫ltimas 50 notificaciones capturadas:
1. Abre **Diagn√≥stico de Notificaciones**
2. Toca **"Ver Notificaciones Capturadas (Debug)"**
3. Revisa la lista de notificaciones con:
   - Package name
   - T√≠tulo y texto
   - Fecha y hora
   - Claves de extras

### Problemas Comunes

#### El servicio no se conecta

**S√≠ntomas:** El estado muestra "‚ùå Acceso a Notificaciones: DESHABILITADO" o el servicio se desconecta frecuentemente.

**Soluciones:**
1. Verifica que el acceso est√© habilitado en Configuraci√≥n del sistema
2. Desactiva optimizaci√≥n de bater√≠a
3. Usa el bot√≥n "Reiniciar Listener" en Diagn√≥stico
4. Reinicia el dispositivo
5. Si persiste, deshabilita y vuelve a habilitar el acceso manualmente

#### No se capturan notificaciones

**S√≠ntomas:** El servicio est√° conectado pero no se reciben notificaciones.

**Soluciones:**
1. Verifica que la app de origen (Yape, BCP, etc.) est√© enviando notificaciones
2. Revisa "Ver Notificaciones Capturadas" para ver si alguna se captura
3. Verifica los logs con `adb logcat | grep PaymentNotificationService`
4. Aseg√∫rate de que la app de origen tenga permisos de notificaci√≥n

#### El servicio se desconecta despu√©s de un tiempo

**S√≠ntomas:** El servicio funciona inicialmente pero se desconecta despu√©s de minutos u horas.

**Soluciones:**
1. **OPPO/Xiaomi/Huawei:** Sigue todos los pasos de optimizaci√≥n de bater√≠a y auto-inicio
2. Verifica que la app no est√© en la lista de "Apps que se duermen"
3. Aseg√∫rate de que "Ejecuci√≥n en segundo plano" est√© permitida
4. Considera desactivar el modo de ahorro de energ√≠a

### Logs para Debugging

Para ver logs detallados del servicio:

```bash
adb logcat | grep PaymentNotificationService
```

Los logs incluyen:
- Eventos de conexi√≥n/desconexi√≥n
- Notificaciones capturadas (package, t√≠tulo, texto, extras)
- Errores y excepciones

---

## C√≥mo Probar

### Prueba B√°sica

1. **Habilitar el acceso:**
   - Abre Yape Notifier
   - Ve a Diagn√≥stico de Notificaciones
   - Toca "Abrir Ajustes de Notificaciones"
   - Habilita Yape Notifier
   - Vuelve a la app y verifica el estado

2. **Enviar notificaci√≥n de prueba:**
   - En MainActivity, toca "Enviar Notificaci√≥n de Prueba"
   - Verifica en "Ver Notificaciones Capturadas" que se captur√≥

3. **Verificar logs:**
   - Conecta el dispositivo v√≠a USB
   - Ejecuta: `adb logcat | grep PaymentNotificationService`
   - Deber√≠as ver logs de `onListenerConnected` y `onNotificationPosted`

### Prueba con App Real

1. **Configurar app de pago:**
   - Instala una app de pago (Yape, BCP, etc.)
   - Aseg√∫rate de que tenga permisos de notificaci√≥n

2. **Generar notificaci√≥n real:**
   - Realiza una transacci√≥n o acci√≥n que genere una notificaci√≥n
   - O pide a alguien que te env√≠e dinero (si es Yape)

3. **Verificar captura:**
   - Abre "Ver Notificaciones Capturadas"
   - Deber√≠as ver la notificaci√≥n con el package name correcto
   - Verifica los logs para confirmar el procesamiento

### Prueba de Reconexi√≥n (OPPO)

1. **Simular desconexi√≥n:**
   - Desactiva y reactiva el acceso a notificaciones
   - O mata la app desde Configuraci√≥n

2. **Reconectar:**
   - Abre la app
   - Ve a Diagn√≥stico
   - Toca "Reiniciar Listener"
   - Verifica que el estado vuelva a "HABILITADO"

3. **Verificar funcionamiento:**
   - Env√≠a una notificaci√≥n de prueba
   - Confirma que se capture correctamente

### Checklist de Pruebas

- [ ] El servicio se conecta al habilitar el acceso
- [ ] Las notificaciones de prueba se capturan
- [ ] Las notificaciones reales se capturan
- [ ] Los logs muestran eventos correctamente
- [ ] El bot√≥n "Reiniciar Listener" funciona
- [ ] El servicio se reconecta despu√©s de reiniciar
- [ ] La optimizaci√≥n de bater√≠a no afecta el servicio (despu√©s de desactivarla)
- [ ] El servicio persiste despu√©s de reiniciar el dispositivo

---

## Notas T√©cnicas

### Componentes del Sistema

- **PaymentNotificationListenerService:** Servicio que escucha notificaciones
- **NotificationAccessChecker:** Helper para verificar y abrir configuraci√≥n
- **ServiceRebinder:** Utilidad para forzar reconexi√≥n del servicio
- **OemDetector:** Detecta el OEM y proporciona recomendaciones
- **AppDatabase (Room):** Almacena √∫ltimas 50 notificaciones para debug

### Limitaciones Conocidas

1. **OPPO/ColorOS:** Puede requerir m√∫ltiples pasos de configuraci√≥n
2. **Xiaomi/MIUI:** Restricciones agresivas de bater√≠a
3. **Huawei/EMUI:** Requiere a√±adir a apps protegidas
4. **Android 12+:** Algunos OEMs tienen restricciones adicionales

### Mejores Pr√°cticas

1. **Siempre verifica el estado** antes de asumir que el servicio funciona
2. **Usa la pantalla de diagn√≥stico** para troubleshooting
3. **Revisa los logs** cuando algo no funciona
4. **Documenta problemas espec√≠ficos** del dispositivo para futuras referencias

---

## Soporte

Si despu√©s de seguir todos los pasos el servicio no funciona:

1. Revisa los logs con `adb logcat`
2. Verifica que todos los pasos del checklist est√©n completados
3. Prueba en otro dispositivo si es posible
4. Documenta el modelo del dispositivo, versi√≥n de Android y OEM

---

**√öltima actualizaci√≥n:** 2024

